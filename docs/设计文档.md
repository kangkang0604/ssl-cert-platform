# SSL证书自动续期平台设计文档

## 1 项目概述

### 1.1 项目背景

随着互联网安全意识的不断提高，SSL证书已成为网站标配。然而，SSL证书通常只有90天到一年的有效期，手动管理证书的续期、部署和监控需要耗费大量的时间和精力，且容易因疏忽导致证书过期，影响网站正常访问。本项目旨在构建一个完整的SSL证书自动续期管理平台，帮助用户自动化管理SSL证书的整个生命周期，包括证书申请、DNS验证、自动续期、多方式部署和实时监控告警等功能。

本平台参考了httpsok.com的核心功能，该平台专注于SSL证书自动续期领域，提供了一键申请、自动部署、证书监控等核心功能。本项目在此基础上，结合现代微服务架构和前后端分离的设计理念，采用Java Spring Boot和Vue3技术栈进行重构和扩展，力求打造一个更加现代化、可扩展、易维护的证书管理平台。

### 1.2 项目目标

本项目的核心目标是构建一个功能完善、架构先进、易于使用的SSL证书自动续期管理平台。具体而言，项目需要实现以下目标：第一，提供完整的证书生命周期管理能力，涵盖证书申请、DNS验证、证书签发、自动续期、手动续期、证书部署和证书吊销等全流程功能；第二，支持多种证书品牌，包括Let's Encrypt、ZeroSSL和Google Trust Services等主流CA机构颁发的证书，满足不同用户的需求；第三，支持多种部署方式，包括Nginx、Apache、IIS、群晖等服务器，以及阿里云CDN、腾讯云COS、负载均衡等云服务，实现一键自动部署；第四，提供完善的证书监控和告警机制，支持证书有效期监控、部署状态监控，并通过邮件、微信、短信等多种渠道发送告警通知；第五，支持套餐管理和多租户功能，为不同规模的用户提供差异化的服务等级。

### 1.3 项目范围

本项目的建设范围涵盖以下内容：后端服务采用Java Spring Boot 3.2框架开发，提供RESTful API接口；前端界面采用Vue3框架开发，使用Element Plus组件库构建现代化UI；数据库采用MySQL 8.0，存储用户信息、证书数据、部署记录等核心业务数据；缓存层采用Redis，提升系统性能和Token管理能力；定时任务采用Spring Task和XXL-JOB，实现证书检查、自动续期、监控告警等定时任务调度。

项目不包括以下内容：SSL证书的实际签发（由第三方CA机构完成）、DNS解析服务的提供（由用户选择的DNS服务商提供）、云服务的API对接（仅提供框架，需用户配置实际凭证）。

## 2 系统架构设计

### 2.1 整体架构

本项目采用经典的前后端分离架构，整体分为四个层次：展示层负责用户界面的呈现和交互逻辑处理；网关层负责请求路由、认证鉴权和限流熔断；服务层负责业务逻辑的处理和数据的持久化；数据层负责数据的存储和缓存。这种分层架构具有良好的解耦性，便于独立开发、测试和部署。

展示层采用Vue3单页应用架构，通过Vue Router实现客户端路由，使用Pinia进行状态管理，通过Axios与服务层进行HTTP通信。Element Plus组件库提供了丰富的UI组件，确保界面的一致性和可用性。Vite作为构建工具，提供了快速的开发体验和优化的生产构建。

网关层采用Spring Cloud Gateway或基于Spring Security的Filter机制实现，负责统一处理所有API请求的认证鉴权。JWT Token用于用户身份标识，Redis用于Token的服务端存储和主动失效。接口层面的权限控制通过注解和拦截器实现，确保每个接口都能精确控制访问权限。

服务层是整个系统的核心，采用Spring Boot 3.2框架构建。Controller层负责接收和响应HTTP请求，处理参数校验和结果封装；Service层负责业务逻辑的实现和事务管理；Mapper层负责与数据库的交互，使用MyBatis-Plus简化CRUD操作；Entity层定义了数据模型，与数据库表一一对应。定时任务通过@Scheduled注解和XXL-JOB实现，支持分布式的任务调度。

数据层采用MySQL作为主数据库，存储所有业务数据；Redis作为缓存数据库，存储会话Token、热点数据和分布式锁；文件存储用于保存证书文件和相关配置。

### 2.2 技术选型

本项目的技术选型遵循以下原则：优先选择成熟稳定的主流技术，确保项目的长期可维护性；优先选择社区活跃、生态丰富的技术栈，便于问题排查和功能扩展；优先选择团队熟悉的技术，降低学习成本和开发风险。

后端技术栈包括：Java 17作为开发语言，充分利用新版本的语法特性；Spring Boot 3.2作为核心框架，提供自动配置和开箱即用的能力；MyBatis-Plus作为ORM框架，简化数据库操作；Spring Security作为安全框架，提供认证授权能力；JWT作为Token机制，实现无状态认证；Redis作为缓存中间件，提升系统性能；Spring Task和XXL-JOB作为任务调度框架，实现定时任务管理。

前端技术栈包括：Vue 3作为前端框架，使用Composition API组织代码；Vite作为构建工具，提供快速的开发体验；Element Plus作为UI组件库，确保界面的美观和一致性；Pinia作为状态管理库，替代Vuex提供更简洁的API；Axios作为HTTP客户端，与后端API进行交互；Vue Router作为路由管理，处理页面导航。

### 2.3 模块划分

系统功能模块划分为以下几部分：用户模块负责用户的注册、登录、个人信息管理、套餐管理等；证书模块负责证书的申请、查询、续期、删除、下载等；域名模块负责域名的添加、验证、状态查询等；服务器模块负责服务器的添加、测试连接、配置管理等；部署模块负责证书到各类型目标的部署操作；监控模块负责证书的监控配置、状态检查、告警通知等；系统模块负责系统配置、权限管理、操作日志等。

各模块之间存在一定的依赖关系：用户模块是其他所有模块的基础，需要用户登录后才能使用其他功能；证书模块依赖域名模块，需要先添加域名才能申请证书；部署模块依赖证书模块和服务器/云服务模块；监控模块依赖证书模块和用户配置。

## 3 数据库设计

### 3.1 设计原则

数据库设计遵循以下原则：第一，范式与反范式平衡，在满足第三范式的基础上，根据实际查询需求进行适度的数据冗余，提升查询性能；第二，主键设计统一，采用自增Long类型作为主键，确保插入性能和数据有序性；第三，字段命名规范，采用小写下划线命名法，与MyBatis-Plus的默认配置保持一致；第四，时间字段统一，使用datetime类型存储时间，并自动维护createTime和updateTime；第五，逻辑删除统一，使用deleted字段标记删除状态，配合MyBatis-Plus的逻辑删除功能。

### 3.2 核心表结构

系统核心表包括用户表、角色表、权限表、套餐表、证书表、域名表、服务器表、部署记录表、监控记录表和通知记录表等。这些表通过外键关联形成完整的业务数据模型。

用户表（sys_user）存储用户账号信息，主要字段包括：id为用户唯一标识；username为用户名，唯一且不可重复；password为加密后的密码，使用BCrypt算法加密；email为用户邮箱，唯一且用于找回密码；phone为手机号，可选；avatar为头像URL；status为用户状态，1为正常，0为禁用；package_id关联当前套餐；package_expire_time为套餐到期时间；total_cert_count等字段记录各资源的配额限制；wechat_openid用于微信扫码登录；last_login_time和last_login_ip记录最后登录信息。

证书表（cert_certificate）存储证书信息，主要字段包括：id为证书唯一标识；user_id关联所属用户；domain_id关联验证通过的域名；cert_type为证书类型，1为单域名，2为多域名，3为通配符；brand为证书品牌，letsencrypt、zerossl或google；domain_name存储域名列表，逗号分隔；cert_pem存储证书内容PEM格式；private_key存储私钥内容；not_before和not_after存储有效期起止时间；days_remaining计算剩余天数；status为证书状态，包括申请中、已签发、即将过期、已过期、已吊销和申请失败；auto_renew标记是否自动续期；renew_count记录续期次数。

套餐表（cert_package）存储套餐信息，主要字段包括：id为套餐唯一标识；name为套餐名称；code为套餐编码，唯一；price为价格；cert_limit为证书数量限制，0表示不限；deploy_limit为部署次数限制；server_limit为服务器授权数量；monitor_limit为监控数量限制；wildcard_cert_limit为通配符证书限制；ov_cert_enable和ev_cert_enable标记是否支持OV和EV证书。

### 3.3 ER关系

实体之间的关系设计如下：用户与角色为多对多关系，通过sys_user_role关联表实现；角色与权限为多对多关系，通过sys_role_permission关联表实现；用户与证书为一对多关系，一个用户可拥有多张证书；用户与域名为一对多关系；用户与服务器为一对多关系；证书与部署记录为一对多关系；证书与监控记录为一对多关系。

## 4 API接口设计

### 4.1 接口规范

API接口设计遵循RESTful规范，采用以下约定：URL使用名词复数形式，如/certificates表示证书资源；HTTP方法表示操作类型，GET查询、POST创建、PUT更新、DELETE删除；响应数据统一封装Result结构，包含code状态码、message消息和data数据；分页查询统一使用pageNum和pageSize参数，返回total总记录数和pages总页数；时间格式统一使用ISO 8601标准，如2026-01-28T10:58:24。

### 4.2 认证接口

认证相关接口包括用户注册、用户登录、用户登出和获取用户信息四个接口。用户注册接口（POST /auth/register）接收username、password、confirmPassword、email等参数，验证用户名和邮箱的唯一性，验证两次密码一致，创建新用户并返回成功响应。用户登录接口（POST /auth/login）接收username和password参数，验证用户存在性和密码正确性，生成JWT Token并存储到Redis，返回Token和用户基本信息。用户登出接口（POST /auth/logout）接收Token参数，从Redis中删除Token记录，返回成功响应。获取用户信息接口（GET /users/profile）从Token中获取用户ID，查询用户详细信息，包括套餐信息和使用情况，返回用户对象。

### 4.3 证书接口

证书相关接口包括证书列表查询、证书详情获取、证书申请、证书删除、证书续期和证书下载六个接口。证书列表查询接口（GET /certificates）支持pageNum、pageSize、keyword和status参数，返回证书分页列表和统计信息。证书详情获取接口（GET /certificates/{certId}）根据证书ID查询详细信息，包括证书内容（PEM格式）和私钥。证书申请接口（POST /certificates）接收certType、brand、domains、dnsProvider、dnsAccessKeyId、dnsAccessKeySecret和autoRenew参数，创建证书申请记录，触发DNS验证流程。证书删除接口（DELETE /certificates/{certId}）执行软删除，将deleted字段置为1。证书续期接口（POST /certificates/{certId}/renew）手动触发证书续期流程。证书下载接口（GET /certificates/{certId}/download）返回证书文件下载。

### 4.4 其他接口

域名相关接口包括域名列表查询、域名添加、域名删除和域名验证。服务器相关接口包括服务器列表查询、服务器添加、服务器测试、服务器编辑和服务器删除。部署相关接口包括部署记录列表、创建部署和重新部署。监控相关接口包括监控列表、监控添加、监控编辑、监控删除和立即检查。

## 5 功能模块详细设计

### 5.1 用户模块

用户模块负责用户账号的全生命周期管理。注册流程包括：接收用户提交的用户名、密码、邮箱等信息；验证用户名格式（4-20位字母数字下划线）和唯一性；验证邮箱格式和唯一性；验证密码长度（6-20位）和确认密码一致性；对密码进行BCrypt加密；创建用户记录，默认分配免费版套餐；返回注册成功响应。

登录流程包括：接收用户名和密码；根据用户名查询用户记录；验证用户状态是否为正常；使用BCrypt验证密码匹配；生成JWT Token，设置过期时间（如24小时）；将Token存储到Redis，key为jwt:token:{userId}；更新用户最后登录时间和IP；返回Token和用户基本信息。

权限控制采用RBAC（基于角色的访问控制）模型：系统预定义超级管理员、普通用户和游客三种角色；每个角色分配相应的权限点；权限点包括菜单权限和按钮权限；用户登录时根据角色获取权限列表；前端根据权限控制菜单和按钮的显示；后端接口通过@PreAuthorize注解进行权限校验。

### 5.2 证书模块

证书申请是系统的核心功能之一。申请流程包括：用户选择证书类型（单域名、多域名、通配符）；用户选择证书品牌（Let's Encrypt、ZeroSSL等）；用户填写域名列表，单域名填一个，多域名或通配符可填多个；用户选择DNS服务商并提供API凭证；系统创建证书记录，状态为申请中；系统生成DNS TXT记录值；用户到DNS服务商处添加TXT记录；系统等待DNS记录生效（通常几分钟到几小时）；系统调用CA的ACME协议接口验证域名所有权；验证通过后CA签发证书；系统下载证书和私钥，存储到数据库；更新证书状态为已签发。

证书续期采用自动和手动两种方式。自动续期流程包括：定时任务每小时检查即将过期的证书（剩余30天以内）；检查证书是否开启了自动续期；调用CA接口进行证书续期；更新证书的有效期（通常再延长90天）；更新续期次数和最后续期时间；触发部署任务将新证书部署到目标服务器。手动续期流程类似，但由用户主动触发，不受定时任务限制。

证书下载功能支持三种格式：证书文件（PEM格式），只包含证书主体；私钥文件，只包含私钥内容；完整证书链，包含证书和私钥。用户可以选择下载格式，系统生成对应的文件并返回下载响应。

### 5.3 部署模块

部署模块负责将证书部署到各种目标。支持的部署目标包括：Nginx服务器，通过SSH连接执行命令，将证书文件复制到指定目录并重载配置；Apache服务器，类似Nginx的部署流程；IIS服务器，使用PowerShell命令导入证书并绑定到站点；群晖NAS，使用DSM API进行证书部署；阿里云CDN，通过API更新HTTPS证书；腾讯云COS，通过API更新证书；阿里云负载均衡，通过API更新证书；WebHook回调，发送证书信息到指定URL，由外部系统自行处理。

部署流程包括：用户选择要部署的证书；用户选择部署目标（服务器或云服务）；用户配置部署参数（如证书路径）；系统创建部署记录，状态为待部署；异步任务执行部署操作；部署成功则更新证书部署时间；部署失败则记录错误信息并发送告警通知。

### 5.4 监控模块

监控模块负责证书状态的持续监控和告警通知。监控配置包括：监控域名配置，支持监控任意域名的SSL证书；检查间隔配置，可设置为30分钟到1天；预警天数配置，证书剩余天数小于此值时触发警告；告警渠道配置，支持邮件、微信、短信三种渠道；告警接收人配置，每个渠道的接收人信息。

监控检查流程包括：定时任务按配置间隔执行检查；解析域名获取SSL证书信息；检查证书有效期，计算剩余天数；根据剩余天数判断状态：正常（大于预警天数）、警告（小于等于预警天数）、危险（小于7天）；根据状态和配置决定是否发送告警；更新监控记录的最后检查时间和状态。

告警通知支持多种渠道：邮件通知通过SMTP发送告警邮件到指定邮箱；微信通知通过微信公众号接口发送模板消息；短信通知通过短信服务商API发送告警短信（需配置短信服务）。

## 6 安全性设计

### 6.1 认证授权

系统采用JWT Token进行身份认证。用户登录成功后，服务端生成JWT Token，包含用户ID、用户名、过期时间等信息，使用HS256算法签名。Token返回给客户端，客户端在后续请求中通过Authorization请求头传递Token。服务端验证Token的签名和过期时间，从Token中获取用户ID，查询Redis确认Token有效（未被主动登出或强制下线），将用户ID注入到请求上下文，供业务逻辑使用。

权限控制采用RBAC模型，分为三个层级：菜单权限控制左侧导航栏的显示；按钮权限控制页面内操作按钮的显示；接口权限控制后端API的访问。权限数据存储在sys_permission表中，通过角色关联用户。管理员可以动态配置权限，无需修改代码。

密码安全采用BCrypt算法进行加密存储。BCrypt是专为密码哈希设计的算法，具有自适应成本因子，能够抵抗彩虹表攻击和暴力破解。每个用户的密码都使用随机的salt进行加密，即使两个用户密码相同，加密后的结果也不同。

### 6.2 数据安全

敏感数据包括用户密码、证书私钥、服务器SSH密钥和密码等。这些数据在存储时进行加密处理：用户密码使用BCrypt加密；证书私钥和服务器密钥使用AES加密存储，密钥通过配置管理。

数据传输采用HTTPS协议，确保数据在传输过程中的机密性和完整性。所有API接口都通过HTTPS访问，防止中间人攻击和数据窃取。

数据库访问通过MyBatis-Plus的参数绑定防止SQL注入，不使用字符串拼接构造SQL。关键操作记录操作日志，便于审计和问题排查。

### 6.3 接口安全

接口层面的安全措施包括：请求频率限制，防止暴力破解和DDoS攻击；参数校验，使用JSR-303注解进行参数验证；错误处理，统一捕获异常，返回脱敏的错误信息；跨域配置，只允许指定的域名访问API。

## 7 部署方案

### 7.1 环境要求

生产环境要求如下：操作系统推荐CentOS 7+/Ubuntu 20+，或Windows Server 2019+；CPU至少2核，推荐4核；内存至少4GB，推荐8GB；硬盘至少50GB，推荐SSD；网络带宽至少1Mbps，推荐5Mbps以上。

软件依赖包括：JDK 17或以上版本；Node.js 18或以上版本；MySQL 8.0或以上版本；Redis 6.0或以上版本；Nginx（可选，用于反向代理和静态资源服务）。

### 7.2 部署架构

推荐采用以下部署架构：前端静态资源通过Nginx托管，配置gzip压缩和缓存策略；Nginx作为反向代理，将/api请求转发到后端服务；后端服务部署至少两个实例，通过负载均衡实现高可用；MySQL和Redis可使用云服务，或自建主从复制确保可用性。

### 7.3 部署步骤

后端部署步骤如下：编译打包项目生成jar文件；上传jar文件到服务器；配置application.yml中的数据库、Redis等连接信息；使用systemd或docker运行服务；配置Nginx反向代理和SSL证书。

前端部署步骤如下：执行npm run build生成静态文件；上传dist目录到服务器；配置Nginx托管静态文件，设置正确的路由规则。

### 7.4 监控运维

系统监控指标包括：CPU使用率、内存使用率、磁盘使用率、网络流量等基础指标；接口响应时间、接口调用量、错误率等业务指标；数据库连接数、慢查询、Redis命中率等数据层指标。

日志管理采用ELK（Elasticsearch、Logstash、Kibana）技术栈或云服务日志收集。所有日志统一输出到标准输出，由容器平台或日志收集器采集。日志格式包含时间戳、日志级别、线程名、类名、请求ID和日志内容。

## 8 项目结构

### 8.1 目录结构

项目整体目录结构如下：

```
ssl-cert-platform/
├── backend/                    # 后端项目
│   ├── src/main/java/com/ssl/
│   │   ├── SSLPlatformApplication.java
│   │   ├── config/             # 配置类
│   │   ├── controller/         # 控制器
│   │   ├── dto/                # 数据传输对象
│   │   ├── entity/             # 实体类
│   │   ├── enums/              # 枚举类
│   │   ├── exception/          # 异常处理
│   │   ├── mapper/             # MyBatis Mapper
│   │   ├── security/           # 安全相关
│   │   ├── service/            # 服务层
│   │   └── util/               # 工具类
│   └── resources/
│       ├── application.yml
│       └── mapper/
├── frontend/                   # 前端项目
│   ├── src/
│   │   ├── api/               # API接口
│   │   ├── assets/            # 静态资源
│   │   ├── components/        # 组件
│   │   ├── layouts/           # 布局
│   │   ├── router/            # 路由
│   │   ├── stores/            # Pinia状态管理
│   │   ├── styles/# 样式
│   │   ├── utils/             # 工具函数
│   │   ├── views/             # 页面
│   │   ├── App.vue
│   │   └── main.js
│   └── package.json
├── database/                   # 数据库脚本
│   └── init.sql
└── docs/                       # 文档
    ├── 数据库设计.md
    └── 设计文档.md
```

### 8.2 快速启动

开发环境启动步骤如下：

后端启动：确保MySQL和Redis服务已启动；导入database/init.sql初始化数据库；修改backend/src/main/resources/application.yml中的数据库和Redis连接配置；使用IDE打开项目，运行SSLPlatformApplication.main()方法；后端服务将在8080端口启动。

前端启动：确保Node.js已安装；进入frontend目录执行npm install安装依赖；执行npm run dev启动开发服务器；前端将在3000端口启动，自动代理/api请求到后端。

生产部署步骤如下：后端执行mvn package -DskipTests打包；将生成的jar文件上传到服务器；配置环境变量和配置文件；使用java -jar命令启动服务。前端执行npm run build打包；将dist目录上传到服务器；配置Nginx托管静态文件。

## 9 总结

本文档详细介绍了SSL证书自动续期平台的设计方案，包括系统架构、数据库设计、API接口、功能模块、安全性和部署方案等内容。项目采用前后端分离架构，后端使用Java Spring Boot 3.2，前端使用Vue3和Element Plus，数据库使用MySQL 8.0，缓存使用Redis。

项目的核心功能包括：用户注册登录和权限管理；SSL证书的申请、DNS验证、签发、续期和下载；证书到Nginx、Apache、IIS等服务器和CDN、COS等云服务的自动部署；证书有效期的监控和多种渠道的告警通知。

通过本项目的实施，用户可以自动化管理SSL证书的整个生命周期，大大降低证书管理的复杂度和风险，确保网站始终使用有效的SSL证书，提升网站的安全性和可信度。