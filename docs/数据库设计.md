# 数据库设计文档

## 1. 数据库概述

### 1.1 数据库信息
- **数据库类型**: MySQL 8.0+ / PostgreSQL 14+
- **数据库名称**: ssl_cert_platform
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci

### 1.2 数据库表清单

| 序号 | 表名 | 说明 |
|------|------|------|
| 1 | sys_user | 用户表 |
| 2 | sys_role | 角色表 |
| 3 | sys_permission | 权限表 |
| 4 | sys_user_role | 用户角色关联表 |
| 5 | sys_role_permission | 角色权限关联表 |
| 6 | cert_package | 套餐表 |
| 7 | cert_order | 订单表 |
| 8 | cert_certificate | 证书表 |
| 9 | cert_domain | 域名表 |
| 10 | cert_deployment | 部署记录表 |
| 11 | cert_server | 服务器表 |
| 12 | cert_monitor | 监控记录表 |
| 13 | cert_notification | 通知记录表 |
| 14 | sys_config | 系统配置表 |
| 15 | sys_operation_log | 操作日志表 |

---

## 2. 详细表设计

### 2.1 用户表 (sys_user)

```sql
CREATE TABLE `sys_user` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `username` varchar(64) NOT NULL COMMENT '用户名',
  `password` varchar(128) NOT NULL COMMENT '密码（加密存储）',
  `email` varchar(128) NOT NULL COMMENT '邮箱',
  `phone` varchar(20) DEFAULT NULL COMMENT '手机号',
  `avatar` varchar(255) DEFAULT NULL COMMENT '头像URL',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态：0-禁用，1-正常',
  `package_id` bigint DEFAULT NULL COMMENT '当前套餐ID',
  `package_expire_time` datetime DEFAULT NULL COMMENT '套餐到期时间',
  `total_cert_count` int DEFAULT 0 COMMENT '证书总数限制',
  `used_cert_count` int DEFAULT 0 COMMENT '已使用证书数',
  `total_server_count` int DEFAULT 1 COMMENT '服务器总数限制',
  `used_server_count` int DEFAULT 0 COMMENT '已使用服务器数',
  `total_deploy_count` int DEFAULT 10 COMMENT '部署次数限制',
  `used_deploy_count` int DEFAULT 0 COMMENT '已使用部署次数',
  `total_monitor_count` int DEFAULT 5 COMMENT '监控数量限制',
  `used_monitor_count` int DEFAULT 0 COMMENT '已使用监控数',
  `wechat_openid` varchar(64) DEFAULT NULL COMMENT '微信OpenID',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` varchar(128) DEFAULT NULL COMMENT '最后登录IP',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email` (`email`),
  KEY `idx_package_id` (`package_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

### 2.2 角色表 (sys_role)

```sql
CREATE TABLE `sys_role` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '角色ID',
  `name` varchar(64) NOT NULL COMMENT '角色名称',
  `code` varchar(64) NOT NULL COMMENT '角色编码',
  `description` varchar(255) DEFAULT NULL COMMENT '角色描述',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态：0-禁用，1-正常',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色表';
```

### 2.3 权限表 (sys_permission)

```sql
CREATE TABLE `sys_permission` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '权限ID',
  `name` varchar(64) NOT NULL COMMENT '权限名称',
  `code` varchar(128) NOT NULL COMMENT '权限编码',
  `type` tinyint NOT NULL COMMENT '类型：1-菜单，2-按钮',
  `parent_id` bigint DEFAULT 0 COMMENT '父级ID',
  `path` varchar(128) DEFAULT NULL COMMENT '路由路径',
  `component` varchar(128) DEFAULT NULL COMMENT '组件路径',
  `icon` varchar(64) DEFAULT NULL COMMENT '图标',
  `sort` int DEFAULT 0 COMMENT '排序',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态：0-禁用，1-正常',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='权限表';
```

### 2.4 用户角色关联表 (sys_user_role)

```sql
CREATE TABLE `sys_user_role` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `role_id` bigint NOT NULL COMMENT '角色ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_role` (`user_id`, `role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户角色关联表';
```

### 2.5 角色权限关联表 (sys_role_permission)

```sql
CREATE TABLE `sys_role_permission` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `role_id` bigint NOT NULL COMMENT '角色ID',
  `permission_id` bigint NOT NULL COMMENT '权限ID',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_permission` (`role_id`, `permission_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色权限关联表';
```

### 2.6 套餐表 (cert_package)

```sql
CREATE TABLE `cert_package` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '套餐ID',
  `name` varchar(64) NOT NULL COMMENT '套餐名称',
  `code` varchar(32) NOT NULL COMMENT '套餐编码',
  `price` decimal(10,2) NOT NULL COMMENT '价格',
  `price_year` decimal(10,2) DEFAULT NULL COMMENT '年费价格',
  `description` varchar(500) DEFAULT NULL COMMENT '套餐描述',
  `icon` varchar(255) DEFAULT NULL COMMENT '图标URL',
  `cert_limit` int NOT NULL COMMENT '证书数量限制（0表示不限）',
  `deploy_limit` int NOT NULL COMMENT '部署次数限制（0表示不限）',
  `server_limit` int NOT NULL COMMENT '服务器授权数量限制（0表示不限）',
  `monitor_limit` int NOT NULL COMMENT '监控数量限制（0表示不限）',
  `wildcard_cert_limit` int DEFAULT 0 COMMENT '通配符证书限制',
  `ov_cert_enable` tinyint DEFAULT 0 COMMENT '是否支持OV证书：0-不支持，1-支持',
  `ev_cert_enable` tinyint DEFAULT 0 COMMENT '是否支持EV证书：0-不支持，1-支持',
  `priority` int DEFAULT 0 COMMENT '排序优先级',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态：0-下架，1-上架',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_code` (`code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='套餐表';
```

**初始化套餐数据：**

```sql
INSERT INTO `cert_package` (`id`, `name`, `code`, `price`, `price_year`, `description`, `cert_limit`, `deploy_limit`, `server_limit`, `monitor_limit`, `wildcard_cert_limit`, `ov_cert_enable`, `ev_cert_enable`, `priority`, `status`) VALUES
(1, '免费版', 'free', 0.00, 0.00, '想体验SSL自动化，测试环境使用', 1, 10, 1, 5, 1, 0, 0, 100, 1),
(2, '个人版', 'personal', 69.00, 69.00, '独立开发者、个人站长、小项目运营者', 5, 200, 3, 30, 5, 0, 0, 90, 1),
(3, '企业基础版', 'enterprise', 199.00, 199.00, '中小企业、正式项目运营者', 30, 2000, 10, 200, 30, 1, 0, 80, 1),
(4, '高级版', 'professional', 599.00, 599.00, '企业、站长、大型项目负责人', 200, 8000, 50, 500, 200, 1, 1, 70, 1);
```

### 2.7 订单表 (cert_order)

```sql
CREATE TABLE `cert_order` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '订单ID',
  `order_no` varchar(64) NOT NULL COMMENT '订单号',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `package_id` bigint NOT NULL COMMENT '套餐ID',
  `pay_type` tinyint NOT NULL COMMENT '支付方式：1-支付宝，2-微信',
  `amount` decimal(10,2) NOT NULL COMMENT '支付金额',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '订单状态：0-待支付，1-已支付，2-已取消，3-已退款',
  `pay_time` datetime DEFAULT NULL COMMENT '支付时间',
  `expire_time` datetime DEFAULT NULL COMMENT '套餐到期时间',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='订单表';
```

### 2.8 证书表 (cert_certificate)

```sql
CREATE TABLE `cert_certificate` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '证书ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `domain_id` bigint DEFAULT NULL COMMENT '关联域名ID',
  `cert_type` tinyint NOT NULL COMMENT '证书类型：1-单域名，2-多域名，3-通配符',
  `brand` varchar(32) NOT NULL COMMENT '证书品牌：letsencrypt、zerossl、google',
  `domain_name` varchar(500) NOT NULL COMMENT '域名（多个用逗号分隔）',
  `subject` varchar(255) DEFAULT NULL COMMENT '证书主题',
  `issuer` varchar(255) DEFAULT NULL COMMENT '证书颁发者',
  `serial_number` varchar(128) DEFAULT NULL COMMENT '证书序列号',
  `cert_dn` text COMMENT '证书DN',
  `cert_pem` text COMMENT '证书内容（PEM格式）',
  `private_key` text COMMENT '私钥内容',
  `not_before` datetime DEFAULT NULL COMMENT '生效时间',
  `not_after` datetime DEFAULT NULL COMMENT '过期时间',
  `days_remaining` int DEFAULT NULL COMMENT '剩余天数',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '证书状态：0-申请中，1-已签发，2-即将过期，3-已过期，4-已吊销，5-申请失败',
  `auto_renew` tinyint NOT NULL DEFAULT 1 COMMENT '是否自动续期：0-否，1-是',
  `renew_count` int DEFAULT 0 COMMENT '续期次数',
  `last_renew_time` datetime DEFAULT NULL COMMENT '最后续期时间',
  `next_renew_time` datetime DEFAULT NULL COMMENT '下次续期时间',
  `error_message` text COMMENT '错误信息',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_domain_id` (`domain_id`),
  KEY `idx_status` (`status`),
  KEY `idx_expire_time` (`not_after`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='证书表';
```

### 2.9 域名表 (cert_domain)

```sql
CREATE TABLE `cert_domain` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '域名ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `domain` varchar(128) NOT NULL COMMENT '域名',
  `domain_type` tinyint DEFAULT 1 COMMENT '域名类型：1-主域名，2-二级域名',
  `dns_provider` varchar(32) DEFAULT NULL COMMENT 'DNS服务商：aliyun、tencent、dnspod、cloudflare',
  `dns_account_id` varchar(128) DEFAULT NULL COMMENT 'DNS账户ID',
  `dns_txt_verification` varchar(255) DEFAULT NULL COMMENT 'DNS TXT验证记录',
  `verification_status` tinyint DEFAULT 0 COMMENT '验证状态：0-未验证，1-验证中，2-验证成功，3-验证失败',
  `verification_time` datetime DEFAULT NULL COMMENT '验证完成时间',
  `resolve_status` tinyint DEFAULT 1 COMMENT '解析状态：0-解析失败，1-解析正常',
  `resolve_ip` varchar(64) DEFAULT NULL COMMENT '解析IP',
  `caa_status` tinyint DEFAULT 1 COMMENT 'CAA记录状态：0-有冲突，1-正常',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_domain` (`domain`),
  KEY `idx_verification_status` (`verification_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='域名表';
```

### 2.10 服务器表 (cert_server)

```sql
CREATE TABLE `cert_server` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '服务器ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `name` varchar(64) NOT NULL COMMENT '服务器名称',
  `type` tinyint NOT NULL COMMENT '服务器类型：1-Nginx，2-Apache，3-IIS，4-群晖，5-其他',
  `host` varchar(128) NOT NULL COMMENT '主机地址',
  `port` int DEFAULT 22 COMMENT 'SSH端口',
  `username` varchar(64) DEFAULT NULL COMMENT '用户名',
  `auth_type` tinyint DEFAULT 1 COMMENT '认证方式：1-密码，2-SSH密钥',
  `password` varchar(255) DEFAULT NULL COMMENT '密码（加密存储）',
  `private_key` text COMMENT 'SSH私钥',
  `cert_path` varchar(255) DEFAULT NULL COMMENT '证书存放路径',
  `key_path` varchar(255) DEFAULT NULL COMMENT '私钥存放路径',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '状态：0-离线，1-在线',
  `last_heartbeat` datetime DEFAULT NULL COMMENT '最后心跳时间',
  `remark` varchar(255) DEFAULT NULL COMMENT '备注',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_type` (`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='服务器表';
```

### 2.11 部署记录表 (cert_deployment)

```sql
CREATE TABLE `cert_deployment` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '部署ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `cert_id` bigint NOT NULL COMMENT '证书ID',
  `server_id` bigint DEFAULT NULL COMMENT '服务器ID',
  `deploy_type` tinyint NOT NULL COMMENT '部署类型：1-服务器，2-CDN，3-COS，4-LB，5-WebHook',
  `target_id` varchar(128) DEFAULT NULL COMMENT '部署目标ID（如CDN域名、COS Bucket等）',
  `target_name` varchar(128) DEFAULT NULL COMMENT '部署目标名称',
  `config` text COMMENT '部署配置',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '部署状态：0-待部署，1-部署中，2-部署成功，3-部署失败',
  `error_message` text COMMENT '错误信息',
  `deploy_time` datetime DEFAULT NULL COMMENT '部署时间',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_cert_id` (`cert_id`),
  KEY `idx_server_id` (`server_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='部署记录表';
```

### 2.12 监控记录表 (cert_monitor)

```sql
CREATE TABLE `cert_monitor` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '监控ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `cert_id` bigint DEFAULT NULL COMMENT '证书ID',
  `domain` varchar(128) NOT NULL COMMENT '监控域名',
  `check_interval` int DEFAULT 3600 COMMENT '检查间隔（秒），默认1小时',
  `warning_days` int DEFAULT 30 COMMENT '预警天数，默认30天',
  `alert_channels` varchar(255) DEFAULT NULL COMMENT '告警渠道：email,wechat,sms（逗号分隔）',
  `alert_email` varchar(128) DEFAULT NULL COMMENT '告警邮箱',
  `alert_wechat` varchar(64) DEFAULT NULL COMMENT '告警微信',
  `last_check_time` datetime DEFAULT NULL COMMENT '最后检查时间',
  `last_status` tinyint DEFAULT NULL COMMENT '最后状态：1-正常，2-警告，3-危险',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '监控状态：0-停用，1-启用',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint NOT NULL DEFAULT 0 COMMENT '删除标识：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_cert_id` (`cert_id`),
  KEY `idx_domain` (`domain`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='监控记录表';
```

### 2.13 通知记录表 (cert_notification)

```sql
CREATE TABLE `cert_notification` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '通知ID',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `monitor_id` bigint DEFAULT NULL COMMENT '监控ID',
  `cert_id` bigint DEFAULT NULL COMMENT '证书ID',
  `type` tinyint NOT NULL COMMENT '通知类型：1-证书即将过期，2-证书已过期，3-部署成功，4-部署失败，5-续期成功，6-续期失败',
  `channel` varchar(32) NOT NULL COMMENT '通知渠道：email,wechat,sms',
  `title` varchar(128) NOT NULL COMMENT '通知标题',
  `content` text NOT NULL COMMENT '通知内容',
  `status` tinyint NOT NULL DEFAULT 0 COMMENT '发送状态：0-待发送，1-发送成功，2-发送失败',
  `send_time` datetime DEFAULT NULL COMMENT '发送时间',
  `error_message` text COMMENT '错误信息',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_monitor_id` (`monitor_id`),
  KEY `idx_cert_id` (`cert_id`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='通知记录表';
```

### 2.14 系统配置表 (sys_config)

```sql
CREATE TABLE `sys_config` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `config_key` varchar(64) NOT NULL COMMENT '配置键',
  `config_value` text NOT NULL COMMENT '配置值',
  `config_type` tinyint DEFAULT 1 COMMENT '配置类型：1-系统配置，2-业务配置',
  `description` varchar(255) DEFAULT NULL COMMENT '配置描述',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_config_key` (`config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统配置表';
```

### 2.15 操作日志表 (sys_operation_log)

```sql
CREATE TABLE `sys_operation_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '日志ID',
  `user_id` bigint DEFAULT NULL COMMENT '用户ID',
  `username` varchar(64) DEFAULT NULL COMMENT '用户名',
  `operation` varchar(32) DEFAULT NULL COMMENT '操作类型',
  `method` varchar(128) DEFAULT NULL COMMENT '请求方法',
  `params` text COMMENT '请求参数',
  `ip` varchar(128) DEFAULT NULL COMMENT '请求IP',
  `user_agent` varchar(255) DEFAULT NULL COMMENT 'User-Agent',
  `status` tinyint DEFAULT 1 COMMENT '状态：0-失败，1-成功',
  `error_message` text COMMENT '错误信息',
  `cost_time` int DEFAULT 0 COMMENT '耗时（毫秒）',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_operation` (`operation`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

---

## 3. 索引优化建议

```sql
-- 用户表索引优化
CREATE INDEX idx_user_status ON sys_user(status);
CREATE INDEX idx_user_package_expire ON sys_user(package_expire_time);

-- 证书表索引优化
CREATE INDEX idx_cert_user_status ON cert_certificate(user_id, status);
CREATE INDEX idx_cert_expire_renew ON cert_certificate(not_after, auto_renew);

-- 部署记录表索引优化
CREATE INDEX idx_deploy_user_cert ON cert_deployment(user_id, cert_id);

-- 监控记录表索引优化
CREATE INDEX idx_monitor_user_status ON cert_monitor(user_id, status);
```

---

## 4. ER图关系

```
sys_user (1) ─── (N) sys_user_role ( ─── (1N)) sys_role (1) ─── (N) sys_role_permission (N) ─── (1) sys_permission
     │
     ├── (N) cert_order
     ├── (N) cert_certificate
     ├── (N) cert_domain
     ├── (N) cert_server
     ├── (N) cert_deployment
     ├── (N) cert_monitor
     └── (N) cert_notification

cert_package (1) ─── (N) cert_order

cert_certificate (1) ─── (N) cert_deployment
     │                      │
     └── (N) cert_domain    └── (N) cert_server
                              │
                              └── (N) cert_notification
```

---

## 5. 初始化数据

### 5.1 初始化管理员账号

```sql
-- 初始化管理员
INSERT INTO `sys_user` (`username`, `password`, `email`, `status`) VALUES
('admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iAt6Z5EH', 'admin@ssl-platform.com', 1);

-- 初始化角色
INSERT INTO `sys_role` (`name`, `code`, `description`) VALUES
('超级管理员', 'super_admin', '拥有所有权限'),
('普通用户', 'user', '普通用户权限'),
('游客', 'guest', '只读权限');

-- 初始化权限
INSERT INTO `sys_permission` (`name`, `code`, `type`, `parent_id`, `path`, `component`, `icon`, `sort`) VALUES
('系统管理', 'system', 1, 0, '/system', 'Layout', 'setting', 100),
('用户管理', 'system:user', 1, 1, '/system/user', 'system/user/index', 'user', 1),
('角色管理', 'system:role', 1, 1, '/system/role', 'system/role/index', 'peoples', 2),
('权限管理', 'system:permission', 1, 1, '/system/permission', 'system/permission/index', 'tree-table', 3),
('证书管理', 'certificate', 1, 0, '/certificate', 'Layout', 'certificate', 10),
('证书列表', 'certificate:list', 1, 5, '/certificate/list', 'certificate/list/index', 'list', 1),
('证书申请', 'certificate:apply', 1, 5, '/certificate/apply', 'certificate/apply/index', 'add', 2),
('域名管理', 'domain', 1, 0, '/domain', 'Layout', 'domain', 20),
('服务器管理', 'server', 1, 0, '/server', 'Layout', 'server', 30),
('部署管理', 'deployment', 1, 0, '/deployment', 'Layout', 'deploy', 40),
('监控管理', 'monitor', 1, 0, '/monitor', 'Layout', 'monitor', 50);
```

### 5.2 初始化系统配置

```sql
INSERT INTO `sys_config` (`config_key`, `config_value`, `config_type`, `description`) VALUES
('sys.site.name', 'SSL证书管理平台', 1, '网站名称'),
('sys.site.logo', '/logo.png', 1, '网站Logo'),
('sys.cert.letsencrypt.api.url', 'https://acme-v02.api.letsencrypt.org/directory', 2, 'Let's Encrypt API地址'),
('sys.cert.zerossl.api.url', 'https://api.zerossl.com/acme', 2, 'ZeroSSL API地址'),
('sys.cert.renew.days.before', '30', 2, '证书续期提前天数'),
('sys.cert.check.interval', '3600', 2, '证书检查间隔（秒）'),
('sys.scheduler.enabled', 'true', 2, '是否启用定时任务');
```
